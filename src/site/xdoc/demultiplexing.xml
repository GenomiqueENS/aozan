<?xml version="1.0" encoding="UTF-8"?>
<!--
                   Aozan development code

  This code may be freely distributed and modified under the
  terms of the GNU General Public License version 3 or later
  and CeCILL. This should be distributed with the code. If you
  do not have a copy, see:

       http://www.gnu.org/licenses/gpl-3.0-standalone.html
       http://www.cecill.info/licences/Licence_CeCILL_V2-en.html

  Copyright for this code is held jointly by the Genomic platform
  of the Institut de Biologie de l'École Normale Supérieure and
  the individual authors. These should be listed in @author doc
  comments.

  For more information on the Aozan project and its aims,
  or to join the Aozan Google group, visit the home page at:

       http://www.transcriptome.ens.fr/aozan

-->
<document>

	<properties>
		<title>Demultiplexing</title>
		<author email="jourdren@biologie.ens.fr">Laurent Jourdren</author>
	</properties>



	<body>

	 <section name="Demultiplexing step">

     <p>This step allow to launch demultiplexing using CASAVA or bcl2fastq. Aozan can use samplesheet in XLS format or generated
     by an external tool in addition of samplesheet in CSV format. Using sample sheet in XLS format allow
     to use alias for adapters sequences indexes.
     <br/><a href="./samplesheet_SNL110_template.xls" target="_blank">See an example of casava design file.</a></p>

	 <p>Alongside Aozan, we provide a standalone CASAVA samplesheet validator available on our website that allows you to check
	 your run design and generate a valid CSV design file.
	 The tool is available <a href="http://www.transcriptome.ens.fr/designvalidator/" target="_blank">here.</a>
	 </p>

     <h4>Configuration parameters</h4>

	 <p>The next table contains the main parameters of this step.</p>

       <table>
	     <tr><th>Aozan property</th><th>Type</th><th>Default value</th><th>description</th></tr>
	     <tr><td>demux.step</td><td>boolean</td><td>True</td><td>Enable the step</td></tr>
	     <tr><td>demux.space.factor</td><td>double</td><td>0.7</td><td>Factor to use to get the estimation of space needed
	     in fastq directory for the run from the space used in bcl directory by the run</td></tr>
	     <tr><td>demux.use.hiseq.output</td><td>boolean</td><td>False</td><td>If it is true and no synchronization step, use direct Hiseq output for demultiplexage step</td></tr>
	     <tr><td>index.sequences</td><td>string</td><td>Not set</td><td>Path to a file that contains alias
	     for adapters sequences indexes. <a href="./indexes-sequences.txt" target="_blank">See an example.</a></td></tr>
	     <tr><td>casava.adapter.fasta.file.path</td><td>string</td><td>Not set</td><td>Adapter sequence file to use when launch CASAVA/bcl2fastq</td></tr>
	     <tr><td>casava.samplesheet.format</td><td>string</td><td>xls</td><td>CASAVA samplesheet format ("csv", "xls" or "command"). (before Aozan-1.1, name casava.design.format)</td></tr>
	     <tr><td>casava.samplesheet.prefix.filename</td><td>string</td><td>samplesheet</td><td>prefix for CASAVA samplesheet file <a href="./samplesheet_SNL110_template.xls" target="_blank">(example).</a></td></tr>
	     <tr><td>casava.design.generator.command</td><td>String</td><td>Not set</td><td>Command to execute to generate the CASAVA samplesheet
  in CSV format when <b>casava.samplesheet.format</b> parameter is set to "command"</td></tr>
	     <tr><td>casava.samplesheets.path</td><td>string</td><td>Not set</td><td>Path to CSV/XLS samplesheet files. (before Aozan-1.1, name casava.designs.path)</td></tr>
	     <tr><td>casava.mismatches</td><td>integer</td><td>0</td><td>Number of mismatches allowed in adapters indexes</td></tr>
	     <tr><td>casava.path</td><td>string</td><td>/usr/local/casava</td><td>Path to CASAVA or Bcl2fastq basedir</td></tr>
	     <tr><td>casava.with.failed.reads</td><td>boolean</td><td>True</td><td>Add reads that not pass Illumina filter in fastq files</td></tr>
	     <tr><td>casava.additionnal.arguments</td><td>string</td><td>Not set</td><td>Additional arguments for CASAVA</td></tr>
	     <tr><td>casava.threads</td><td>integer</td><td>Number of computer cores</td><td>Number of threads to use for demultiplexing</td></tr>
	   </table>

	 <p>The next table contains the parameters required for bcl2fastq 1.8.4 but not bcl2fastq 2.</p>

       <table>
	     <tr><th>Aozan property</th><th>Type</th><th>Default value</th><th>description</th></tr>
	     <tr><td>casava.compression</td><td>string</td><td>bzip2</td><td>Compression to use (.bz2, .gz, none, bzip2, gz, gzip). <a href="./quickstart.html#bcl2fastq">To use format bzip2, read "how installing bcl2fastq".</a></td></tr>
	     <tr><td>casava.compression.level</td><td>integer</td><td>9</td><td>Compression level</td></tr>
	     <tr><td>casava.fastq.cluster.count</td><td>integer</td><td>0</td><td>Cluster number by fastq file. When set to 0 no limit
  will be set</td></tr>
	     	     	   
	     </table>
	   
	<p><b>Nota Bene</b>: with bcl2fastq2, it is no more possible to change default compression format &quot;gz&quot; in &quot;bzip2&quot;.
		In the near future, Aozan will include a new functionality to convert the compressed FASTQ files.</p>

	     
 	 <h4>Configuration to run bcl2fastq with Docker images.</h4>

	 <p>This Aozan version can run Docker image for demultiplexing step. On our platform, we build a new image for each bcl2fastq version.
	 	We can downloaded from <a href="https://hub.docker.com/u/genomicpariscentre"> the repository genomic paris center</a></p>

       <table>
	     <tr><th>Aozan property</th><th>Type</th><th>Default value</th><th>description</th></tr>
	     <tr><td>demux.use.docker.enable</td><td>boolean</td><td>True</td>
	     	<td>Enable to use Docker container to run bcl2fastq for demultiplexing.</td></tr>
     	<tr><td>bcl2fastq.version.for.hiseq</td><td>string</td><td>2.17.1.14</td><td>Full name on Docker image container to use. 
     		Example RTA version1 (software Illumina Real Time Analysis 1, it used with HiSeq sequencer). 
     		To use previous version on blc2fastq, we should call 1.8.4 Docker image name.</td></tr>
     	<tr><td>bcl2fastq.version.for.nextseq</td><td>string</td><td>latest</td><td>Full name on Docker image container to use. 
     		</td></tr>
	   </table>
	   
	   
	   <p><b>Nota Bene</b>: actually, Aozan check syntax on samplesheet for version 1 and 2 on bcl2fastq software. 
	   	For bcl2fastq version 2, in session Data, the header column Sample_Name is forbidden.</p>
	   	
        <p>An example of email sent at the end of demultiplexing step.</p>
       <div align="center">
       		<img src="images/mail_demultiplexing.png" alt="example mail sent at the end of demultiplexing" border="1"/>
       	</div>
   </section>
	</body>
</document>
