<?xml version="1.0" encoding="UTF-8"?>
<!-- 
/*
 *                  Aozan development code
 *
 * This code may be freely distributed and modified under the
 * terms of the GNU General Public License version 3 or later 
 * and CeCILL. This should be distributed with the code. If you 
 * do not have a copy, see:
 *
 *      http://www.gnu.org/licenses/gpl-3.0-standalone.html
 *      http://www.cecill.info/licences/Licence_CeCILL_V2-en.html
 *
 * Copyright for this code is held jointly by the Genomic platform
 * of the Institut de Biologie de l'École Normale Supérieure and
 * the individual authors. These should be listed in @author doc
 * comments.
 *
 * For more information on the Aozan project and its aims,
 * or to join the Aozan Google group, visit the home page at:
 *
 *      http://www.transcriptome.ens.fr/aozan
 *
 */
 -->
<document>

	<properties>
		<title>Contamination detection</title>
		<author email="sperrin@biologie.ens.fr">Sandrine Perrin</author>
	</properties>



	<body>

		<section name="Contamination detection step">
			<p>This step assesses the sample contamination from the fastq files. To do Aozan uses the principles from 
			<a href="http://www.bioinformatics.babraham.ac.uk/projects/fastq_screen/"  target="_blank">FastQ Screen</a>. 
			FastQ Screen allows to screen a library of sequences in Fastq format against a set of sequence databases. </p>
			
			<p>The code has been rewriting in Aozan and additional values have been creating.
			There we use <a href="http://bowtie-bio.sourceforge.net/manual.shtml"  target="_blank">bowtie</a> to align reads 
			to reference genomes or contaminant databases like adapter sequences, PhiX and ribosomes databases.
			Moreover it aligns on the genome of the sample based on the data in the casava design file.
			</p>

			<p>All the reads are aligned, currently. The runtime is very long, even with the multithreading option of bowtie. 
			The list of reference genomes is limited to the essential.
			For reduce the runtime, if necessary, all fastq files are uncompressed in multithreading mode. 
			After, the align on reference genomes is launched. At the end, all temporary fastq files are removed. 
			This solution requires to have a lot of free space in temporary directory defined. 
			Aozan estimates the needed space and sends an warning email if it is not enough.
			</p>
			
			<h4>Configuration parameters</h4>

			<p>For used fastqscreen, the key-value pair must be like that &quot;qc.step=True&quot;
			 in Aozan configuration file. Moreover at least one test must to be &quot;True&quot;.</p>

			<h5>General configuration for launch the mapper.</h5>
			<p>Aozan uses the development in other framework from the platform, 
			<a href="http://transcriptome.ens.fr/eoulsan"  target="_blank">Eoulsan,</a>for management alignment automatic. 
			<a href="http://transcriptome.ens.fr/eoulsan/datarepositories.html" target="_blank">More details in this page.</a>
			</p>
			
			<table><tr>
					<th>Aozan property</th>
					<th>Type</th>
					<th>description</th>
				</tr>
				<tr>
					<td>qc.conf.genome.alias.path</td>
					<td>string</td>
					<td>Path to the file which make the correspondance between genome
						name in casava design file and the genome name reference used for
						identified index of bowtie. If a genome's name doesn't exist in the alias file, it's added at the end. 
					</td>
				</tr>

				<tr>
					<td>qc.conf.settings.genomes.desc.path</td>
					<td>string</td>
					<td>Path to the genomes descriptions repository. The genome
						description file contains some basic informations
						about the genome
						like the chromosome length. The repository allow to
						avoid useless
						genome sequence parsing
						once it has been already parsed in a
						previous run.
					</td>
				</tr>

				<tr>
					<td>qc.conf.settings.genomes</td>
					<td>string</td>
					<td>Path to the genomes repository.</td>
				</tr>

				<tr>
					<td>qc.conf.settings.mappers.indexes.path</td>
					<td>string</td>
					<td>Path to the genomes indexes repository.</td>
				</tr>

				<tr>
					<td>qc.conf.fastqscreen.genomes</td>
					<td>string</td>
					<td>List of reference genomes used per default for fastqscreen
						(e.g. phix, adapters)</td>
				</tr>

			</table>

			<H5>Configuration tests</H5>

			<p>
			Fastqscreen will been launched, if at least one test is enable.
			</p>

			<table>
				<tr>
					<th>Aozan property</th>
					<th>Type</th>
					<th>Default value</th>
					<th>description</th>
				</tr>
				<tr>
					<td>qc.test.hitnolibraries.enable</td>
					<td>boolean</td>
					<td>False</td>
					<td>A report of quality control contains a column with the percent 
					of reads mapped at least one reference genomes, except on genome sample test</td>
				</tr>
				<tr>
					<td>qc.test.hitnolibraries.interval</td>
					<td>double interval</td>
					<td>[0, 0.1]</td>
					<td>Interval of valid values</td>
				</tr>
				<tr>
					<td>qc.test.fsqmapped.enable</td>
					<td>boolean</td>
					<td>False</td>
					<td>A report of quality control contains a column with the percent
					 of reads mapped for each reference genome test.</td>
				</tr>
				<tr>
					<td>qc.test.fsqmapped.interval</td>
					<td>double interval</td>
					<td>[0, 0.1]</td>
					<td>Interval of valid values. If the genome is this of sample, the interval is reverse (ex: [0.9, 1])</td>
				</tr>

				<tr>
					<td>qc.test.linkreport.enable</td>
					<td>boolean</td>
					<td>False</td>
					<td>A report of quality control contains a column with link to report fastqscreen file, 
					save in quality control directory.</td>
				</tr>
			</table>

		<p>An example of a report fastqscreen with four reference genomes and the genome sample (hg19) :
		<div align="center">
			<table><tr><th align="center"><img src="images/report_fastqscreen.png" alt="" border="1"></img></th></tr></table>
		</div>
		</p>
		
		<p>An example of a report of quality control with major values of fastqscreen. 
		<div align="center">
			<table><tr><th align="center"><img src="images/tab_fastqscreen.png" alt="" border="1"></img></th></tr></table>
		
		</div>
		</p>
		</section>

	</body>

</document>